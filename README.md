# 📧 研修会管理システム v2.0

Google Apps Script (GAS) を使用した研修会の案内メール配信・出欠管理システムです。

## 📋 目次

- [概要](#概要)
- [機能一覧](#機能一覧)
- [システム構成](#システム構成)
- [セットアップ手順](#セットアップ手順)
- [使い方](#使い方)
- [設定項目](#設定項目)
- [シート構成](#シート構成)
- [自動化機能](#自動化機能)
- [トラブルシューティング](#トラブルシューティング)
- [ファイル一覧](#ファイル一覧)

---

## 概要

年間15回程度の研修会を運営する事務局向けに設計されたシステムです。

**主な特徴:**
- 📨 参加者への案内メール一斉配信
- 📝 Googleフォームによる出欠確認
- 🔔 未回答者への自動リマインダー
- 📅 年間スケジュール管理
- 📄 出欠一覧のPDF出力
- ⚙️ 自動送信トリガー

---

## 機能一覧

### 基本機能

| 機能 | 説明 |
|------|------|
| 案内メール送信 | 参加者全員に研修会案内メールを一斉送信 |
| テスト送信 | 自分のアドレスのみにテスト送信 |
| 出欠フォーム作成 | Googleフォームを自動生成、スプレッドシートと連携 |
| 出欠状況確認 | 回答状況をリアルタイムで集計 |
| 添付資料対応 | 指定フォルダ内のファイルを自動添付 |

### v2.0 新機能

| 機能 | 説明 |
|------|------|
| リマインダー送信 | 未回答者を自動検出してリマインダーメールを送信 |
| 年間スケジュール管理 | 年間の研修会予定を一元管理、当日シートへワンクリック転記 |
| PDF出力 | 出欠一覧をPDF形式で出力・保存 |
| 自動送信トリガー | 指定日数前に自動で案内・リマインダーを送信 |

---

## システム構成

```
📁 AI-Managed-Sheets/（または指定フォルダ）
└── 📁 研修会管理システム/
    ├── 📊 研修会管理システム（スプレッドシート）
    │   ├── 参加者マスター
    │   ├── 当日研修会
    │   ├── メールテンプレート
    │   ├── 送信履歴
    │   ├── 出欠回答
    │   ├── 年間スケジュール
    │   └── 設定（非表示）
    ├── 📁 添付資料/
    └── 📝 出欠確認フォーム（自動生成）
```

### アーキテクチャ

```
┌─────────────────────────────────────┐
│ TrainingSystemLib（ライブラリ）      │
│ ・共通機能を提供                     │
│ ・複数プロジェクトで再利用可能       │
└─────────────────────────────────────┘
            ↓ 参照
┌─────────────────────────────────────┐
│ TrainingSystemClient（各プロジェクト）│
│ ・CONFIG設定                         │
│ ・メニューUI                         │
│ ・トリガー関数                       │
└─────────────────────────────────────┘
```

---

## セットアップ手順

### Step 1: ライブラリを登録

1. [Google Apps Script](https://script.google.com) を開く
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「**TrainingSystemLib**」に変更
4. `TrainingSystemLib-v2.gs` の内容を貼り付け
5. 保存（Ctrl+S）
6. 「デプロイ」→「新しいデプロイ」→「ライブラリ」を選択
7. 「デプロイ」をクリック
8. 「プロジェクトの設定」から**スクリプトID**をコピー

### Step 2: クライアントプロジェクトを作成

#### 方法A: スタンドアロン型（推奨）

1. [Google Apps Script](https://script.google.com) で「新しいプロジェクト」
2. `TrainingSystemClient-v3.gs` の内容を貼り付け
3. `CONFIG` を編集（Step 3参照）
4. 「ライブラリ」の「+」をクリック
5. Step 1 でコピーしたスクリプトIDを貼り付け
6. バージョンを選択して「追加」

#### 方法B: スプレッドシート紐付け型

1. 新しいスプレッドシートを作成
2. 「拡張機能」→「Apps Script」
3. 以降は方法Aと同じ

### Step 3: CONFIGを編集

```javascript
const CONFIG = {
  // ★必須: 親フォルダID（Google DriveフォルダのURL末尾のID）
  parentFolderId: '1F_fDvNwobQc6N_H4ryewGXEJlWoqmpau',
  
  // フォルダ・ファイル名
  systemFolderName: '研修会管理システム',
  attachmentFolderName: '添付資料',
  spreadsheetName: '研修会管理システム',
  
  // メール設定
  senderName: '研修会事務局',
  
  // 日数設定
  attendanceDeadlineDays: 3,   // 回答期限（研修日の何日前）
  autoSendDaysBefore: 7,       // 自動送信（研修日の何日前）
  reminderDaysBefore: 2        // リマインダー（研修日の何日前）
};
```

### Step 4: 初期セットアップ実行

1. Apps Scriptエディタで **TrainingSystemClient-v3.gs** のコードが表示されていることを確認
2. 関数選択ドロップダウン（エディタ上部）から `setupSystem` を選択
3. 「▶ 実行」をクリック
4. 権限の承認画面が表示されたら許可
5. 実行ログに表示されるスプレッドシートURLを開く

---

## 使い方

### 基本的な運用フロー

```
1️⃣ 年間スケジュールシートに研修会予定を入力
        ↓
2️⃣ メニュー「📅 年間スケジュール」→「次回研修会を当日シートにコピー」
        ↓
3️⃣ 当日研修会シートで詳細を確認・編集
        ↓
4️⃣ 添付資料フォルダに資料を配置
        ↓
5️⃣ メニュー「📝 出欠確認フォームを作成」
        ↓
6️⃣ メニュー「📨 テスト送信」で確認
        ↓
7️⃣ メニュー「📨 案内メールを送信」
        ↓
8️⃣ 回答状況を確認、必要に応じてリマインダー送信
        ↓
9️⃣ 研修前日「📄 出欠一覧をPDF出力」
        ↓
🔟 研修後「🗑️ 当日研修会をクリア」
```

### メニュー構成

```
📧 研修会管理
├── 📝 出欠確認フォームを作成
├── ─────────────
├── 📨 案内メールを送信
├── 📨 テスト送信（自分のみ）
├── ─────────────
├── 📊 出欠状況を確認
├── 🔔 未回答者にリマインダー送信
├── 📄 出欠一覧をPDF出力
├── ─────────────
├── 📅 年間スケジュール
│   ├── 次回研修会を当日シートにコピー
│   └── 年間スケジュール一覧を表示
├── ─────────────
├── ⚙️ 自動化設定
│   ├── 🟢 自動送信を有効化（毎朝9時）
│   ├── 🔴 自動送信を無効化
│   └── 📋 トリガー状態を確認
├── ─────────────
├── 🗑️ 当日研修会をクリア
└── 📁 添付資料フォルダを開く
```

---

## 設定項目

### CONFIG オプション

| 項目 | 型 | デフォルト | 説明 |
|------|---|----------|------|
| `parentFolderId` | string | **必須** | 親フォルダのID |
| `systemFolderName` | string | '研修会管理システム' | システムフォルダ名 |
| `attachmentFolderName` | string | '添付資料' | 添付資料フォルダ名 |
| `spreadsheetName` | string | '研修会管理システム' | スプレッドシート名 |
| `senderName` | string | '研修会事務局' | メール送信者名 |
| `attendanceDeadlineDays` | number | 3 | 回答期限（研修日の何日前） |
| `autoSendDaysBefore` | number | 7 | 自動案内送信（研修日の何日前） |
| `reminderDaysBefore` | number | 2 | 自動リマインダー（研修日の何日前） |

### メールテンプレート プレースホルダー

| プレースホルダー | 置換内容 |
|----------------|---------|
| `{{氏名}}` | 参加者の氏名 |
| `{{メールアドレス}}` | 参加者のメールアドレス |
| `{{所属}}` | 参加者の所属 |
| `{{役職}}` | 参加者の役職 |
| `{{研修会名}}` | 研修会名 |
| `{{開催日}}` | 開催日 |
| `{{開催時間}}` | 開催時間 |
| `{{会場}}` | 会場名 |
| `{{会場住所}}` | 会場住所 |
| `{{講師名}}` | 講師名 |
| `{{研修内容}}` | 研修内容 |
| `{{出欠フォームURL}}` | 出欠確認フォームのURL |
| `{{回答期限}}` | 回答期限日 |

---

## シート構成

### 参加者マスター

| No | 氏名 | メールアドレス | 所属 | 役職 | 備考 | 有効 |
|----|------|---------------|------|------|------|------|
| 1 | 山田 太郎 | yamada@example.com | A社 | 部長 | | ○ |
| 2 | 佐藤 花子 | sato@example.com | B社 | 課長 | | ○ |

- **有効**: `○` = 送信対象、`×` = 送信対象外

### 当日研修会

| 項目 | 値 |
|------|---|
| 研修会名 | 第1回 ○○研修会 |
| 開催日 | 2025/04/15 |
| 開催時間 | 14:00〜17:00 |
| 会場 | ○○会館 |
| 会場住所 | 東京都... |
| 講師名 | 山田 先生 |
| 研修内容 | ... |
| 出欠フォームURL | （自動生成） |
| フォームID | （自動生成） |

### 年間スケジュール

| 回 | 研修会名 | 開催日 | 時間 | 会場 | 講師 | ステータス | 備考 |
|----|---------|--------|------|------|------|-----------|------|
| 1 | 第1回研修 | 2025/04/15 | 14:00〜17:00 | ○○会館 | 山田先生 | 予定 | |

- **ステータス**: `予定` → `案内済` → `完了` または `中止`

---

## 自動化機能

### 自動送信の仕組み

```
毎朝9時に自動実行（トリガー）
    ↓
年間スケジュールをチェック
    ↓
┌─────────────────────────────────────┐
│ 7日後に研修会がある？               │
│   → YES: 案内メールを自動送信       │
│   → ステータスを「案内済」に更新    │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│ 2日後に研修会がある？               │
│   → YES: 未回答者にリマインダー送信 │
└─────────────────────────────────────┘
```

### トリガー設定方法

**有効化:**
```
メニュー「⚙️ 自動化設定」→「🟢 自動送信を有効化」
```

**無効化:**
```
メニュー「⚙️ 自動化設定」→「🔴 自動送信を無効化」
```

**状態確認:**
```
メニュー「⚙️ 自動化設定」→「📋 トリガー状態を確認」
```

---

## トラブルシューティング

### よくあるエラー

#### 「Cannot call SpreadsheetApp.getUi() from this context」

**原因:** スタンドアロン型プロジェクトからUI関数を呼び出している

**解決方法:**
1. 作成されたスプレッドシートを開く
2. 「拡張機能」→「Apps Script」からコードを実行
3. または `TrainingSystemClient-v3.gs`（UI対応版）を使用

#### 「ライブラリが見つかりません」

**原因:** スクリプトIDが間違っている、または共有設定の問題

**解決方法:**
1. ライブラリプロジェクトの「プロジェクトの設定」からスクリプトIDを再確認
2. ライブラリの共有設定を確認（「リンクを知っている全員」に設定）

#### 「parentFolderId は必須です」

**原因:** CONFIGの `parentFolderId` が未設定

**解決方法:**
1. Google DriveでフォルダのURLを開く
2. URL末尾のIDをコピー（例: `https://drive.google.com/drive/folders/1ABC...XYZ`）
3. CONFIGに設定

#### メールが送信されない

**チェックリスト:**
- [ ] 「参加者マスター」シートに参加者が登録されているか
- [ ] 「有効」列が `○` になっているか
- [ ] メールアドレスが正しいか
- [ ] GmailのAPI制限（1日500通）に達していないか

---

## ファイル一覧

| ファイル名 | 用途 |
|-----------|------|
| `TrainingSystemLib-v2.gs` | ライブラリ本体（共通機能） |
| `TrainingSystemClient-v3.gs` | クライアントコード（メニュー・UI） |
| `README.md` | このドキュメント |

---

## バージョン履歴

### v2.0 (2025-01-07)
- 🆕 未回答者リマインダー送信機能
- 🆕 年間スケジュール管理機能
- 🆕 出欠一覧PDF出力機能
- 🆕 自動送信トリガー機能

### v1.0
- 📨 案内メール送信
- 📝 出欠フォーム自動作成
- 📊 出欠状況確認
- 📁 添付ファイル対応

---

## ライセンス

MIT License

---

## サポート

ご質問・ご要望がありましたら、お気軽にお問い合わせください。
